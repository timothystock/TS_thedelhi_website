jQuery(function(e){function t(t){var n=this;this.$el=t,this.$content=t.find(".bto_group_data"),this.$metabox_title=t.find("h3 .group_name"),this.$section_links=this.$content.find(".subsubsub a"),this.$sections=this.$content.find(".tab_group"),this.$discount=this.$content.find(".group_discount"),this.$filters=this.$content.find(".group_filters"),this.$display_prices=this.$content.find(".component_display_prices"),this.$pagination_style=this.$content.find(".component_pagination_style"),this.$query_type_containers=this.$content.find(".component_query_type_selector"),this.$query_type_selector=this.$content.find("select.component_query_type"),this.$options_style_selector=this.$content.find("select.options_style_selector"),this.$categories_selector=this.$content.find("select.categories_selector"),this.$products_selector=this.$content.find("select.products_selector"),this.$default_selectors_container=this.$content.find(".default_selector_container"),this.$default_selectors=this.$content.find(".default_selector_wrapper"),this.$default_selector_categories=this.$content.find("select.default_selector_categories"),this.$default_selector_products=this.$content.find("select.default_selector_products"),this.$optional_checkbox=this.$content.find("input.component_optional"),this.$title_input=this.$content.find("input.group_title"),this.$priced_individually_input=this.$content.find(".group_priced_individually input"),this.$show_filters_input=this.$content.find(".group_show_filters input"),this.initialized_selects=!1,this.component_toggled=function(){n.component_poked();var e=this.$el,t=this.$content;setTimeout(function(){e.toggleClass("closed").toggleClass("open"),t.stop().slideToggle()},50)},this.component_poked=function(){n.initialized_selects||n.initialize_selects()},this.section_changed=function(e){n.$section_links.removeClass("current"),e.addClass("current"),n.$sections.addClass("tab_group_hidden"),n.$content.find(".tab_group_"+e.data("tab")).removeClass("tab_group_hidden")},this.title_changed=function(){n.$metabox_title.text(n.$title_input.val()),o(!0)},this.query_type_changed=function(){n.$query_type_containers.hide(),n.$default_selectors.hide();var e=n.$query_type_selector.val();n.$content.find(".component_query_type_"+e).show(),this.initialized_selects&&("category_ids"===e?(n.reinitialize_default_option_category_select(),n.maybe_update_default_option_category_ids(!0)):(n.initialize_default_option_product_select(),n.default_option_changed()),o(!0))},this.products_changed=function(){n.initialize_default_option_product_select(),n.default_option_changed(),o(!0)},this.categories_changed=function(){var e=n.get_category_ids();n.$default_selector_categories.data("include",e.join()),n.maybe_update_default_option_category_ids(!0),o(!0)},this.optional_changed=function(){n.default_option_changed(),o(!0)},this.options_style_changed=function(){"yes"===n.$options_style_selector.find('option[value="'+n.$options_style_selector.val()+'"]').data("supports").pagination?n.$pagination_style.show():n.$pagination_style.hide()},this.priced_individually_input_changed=function(){n.$priced_individually_input.is(":checked")?(n.$discount.show(),n.$display_prices.show()):(n.$discount.hide(),n.$display_prices.hide())},this.show_filters_input_changed=function(){n.$show_filters_input.is(":checked")?n.$filters.show():n.$filters.hide()},this.default_option_changed=function(){var e=n.$query_type_selector.val(),t=n.get_default_option(),o=n.get_default_option_html(),i="category_ids"===e?n.$default_selector_categories.val():n.$default_selector_products.val(),a=!0,c=!1;if(!i&&!n.is_optional())if("category_ids"===e)"defaults"===f.val()&&n.get_category_ids().length>0&&(c="set_defaults");else{var s=n.get_product_ids().length;s>0&&("defaults"===f.val()?c="set_defaults":1===s&&(c="set_defaults_static"))}c&&(n.has_error(n.$default_selectors_container)||(setTimeout(function(){n.add_error_tip(n.$default_selectors_container,c)},5),t||n.add_error(n.$default_selectors_container,c)),"product_ids"===e?n.$default_selector_products.val(t).triggerHandler("change"):o&&n.$default_selector_categories.append(o).val(t).triggerHandler("change"),a=!1),a&&(n.clear_error(n.$default_selectors_container),n.set_default_option(i))},this.add_error_tip=function(t,o){var n=t.position();0===t.parent().find(".wc_error_tip").length&&(t.after('<div class="wc_error_tip">'+wc_composite_admin_params["i18n_"+o]+"</div>"),t.parent().find(".wc_error_tip").css("left",n.left+t.width()-t.width()/2-e(".wc_error_tip").width()/2).css("top",n.top+t.height()).fadeIn("100"))},this.has_error=function(e){return e.hasClass("selection_error")},this.add_error=function(e,t){e.find(".wc-cp-error-tip").attr("data-tip",wc_composite_admin_params["i18n_"+t]),e.find(".wc-cp-error-tip").tipTip(D),e.addClass("selection_error")},this.clear_error=function(e){e.removeClass("selection_error")},this.initialize=function(){n.query_type_changed(),n.options_style_changed(),n.priced_individually_input_changed(),n.show_filters_input_changed()},this.initialize_default_option_category_select=function(){void 0===n.get_default_option_html()&&n.save_default_option_html()},this.reinitialize_default_option_category_select=function(){var e=n.get_default_option(),t=n.get_default_option_html();t&&n.$default_selector_categories.append(t),n.$default_selector_categories.val(e).triggerHandler("change")},this.initialize_default_option_product_select=function(){var e=n.$products_selector.find(":selected").clone().removeAttr("selected"),t=n.get_default_option()&&e.filter('[value="'+n.get_default_option()+'"]').length>0;if(n.$default_selector_products.find("option").remove(),n.$default_selector_products.append(e),!t){var o=!n.is_optional()&&e.length>0&&("defaults"===f.val()||1===e.length)?e.first().val():0;n.set_default_option(o)}n.$default_selector_products.val(n.get_default_option()).triggerHandler("change")},this.initialize_selects=function(){"category_ids"===n.$query_type_selector.val()?n.initialize_default_option_category_select():n.initialize_default_option_product_select(),n.initialize_select2s()},this.initialize_select2s=function(){var e=n.$content.find(".wc-product-search-lazy"),t=n.$content.find(".wc-enhanced-select-lazy");e.addClass("wc-product-search"),t.addClass("wc-enhanced-select"),n.$content.wc_cp_select2(),e.removeClass("wc-product-search"),t.removeClass("wc-enhanced-select"),n.initialized_selects=!0},this.maybe_update_default_option_category_ids=function(t){if(t=t||!1,null===n.get_default_option_category_ids()){n.update_default_option_category_ids_xhr&&n.update_default_option_category_ids_xhr.abort();var o={action:"woocommerce_get_product_categories",product_id:n.get_default_option(),security:wc_composite_admin_params.get_product_categories_nonce};n.update_default_option_category_ids_xhr=e.post(woocommerce_admin_meta_boxes.ajax_url,o,function(e){n.set_default_option_category_ids("success"===e.result?e.category_ids:[]),t&&n.check_default_option_in_category_ids()})}else t&&n.check_default_option_in_category_ids()},this.check_default_option_in_category_ids=function(){(n.get_default_option()&&!n.is_default_option_in_category_ids()||0===n.get_category_ids().length)&&(n.set_default_option(0),n.$default_selector_categories.val(0).trigger("change"))},this.is_default_option_in_category_ids=function(){var t=n.get_selector_data(n.$categories_selector),o=n.get_default_option_category_ids(),i=[];e.each(t,function(e,t){i.push(parseInt(t.id))});var a=!1;return e.each(o,function(e,t){if(n.array_contains(parseInt(t),i))return a=!0,!1}),a},this.get_default_option_category_ids=function(){return this.$default_selectors_container.data("selected_data").default_option_category_ids},this.set_default_option_category_ids=function(e){this.$default_selectors_container.data("selected_data").default_option_category_ids=e},this.get_default_option_html=function(){return this.$default_selectors_container.data("selected_data").default_option_html},this.save_default_option_html=function(){var e=this.$default_selectors_container.data("selected_data");if(n.get_default_option()){var t="category_ids"===n.$query_type_selector.val()?n.$default_selector_categories.find(":selected").clone():n.$default_selector_products.find(":selected").clone();e.default_option_html=t}else e.default_option_html=!1},this.get_default_option=function(){return this.$default_selectors_container.data("selected_data").default_option_id||0},this.set_default_option=function(e){var t=this.$default_selectors_container.data("selected_data");t.default_option_id=e||0,n.save_default_option_html(),n.set_default_option_category_ids(!!t.default_option_id&&null),n.maybe_update_default_option_category_ids()},this.get_selector_data=function(e){return"yes"===wc_composite_admin_params.is_wc_version_gte_3_2?e.selectWoo("data"):e.select2("data")},this.get_category_ids=function(){var t=n.get_selector_data(n.$categories_selector),o=[];return e.each(t,function(e,t){o.push(parseInt(t.id))}),o},this.get_product_ids=function(){var t=n.get_selector_data(n.$products_selector),o=[];return e.each(t,function(e,t){o.push(parseInt(t.id))}),o},this.array_contains=function(t,o){return-1!==e.inArray(t,o)},this.is_optional=function(){return n.$optional_checkbox.is(":checked")},this.initialize()}function o(e){j=e=!!e}function n(){v.length>0?(g.removeClass("no-components"),m.removeClass("disabled")):(g.addClass("no-components"),m.addClass("disabled"))}function i(){g.on("click",".expand_all",function(){return!e(this).hasClass("disabled")&&(e.each(y,function(e,t){t.initialize_selects(),setTimeout(function(){t.$el.addClass("open").removeClass("closed"),t.$content.show()},50)}),!1)}).on("click",".close_all",function(){return!e(this).hasClass("disabled")&&(e.each(y,function(e,t){setTimeout(function(){t.$el.addClass("closed").removeClass("open"),t.$content.hide()},10)}),!1)}).on("mouseover",".bto_group_handle",function(){var t=e(this).closest(".bto_group").data("component_metabox_id"),o=y[t];void 0!==o&&o.component_poked()}).on("click",".bto_group_handle",function(){var t=e(this).closest(".bto_group").data("component_metabox_id"),o=y[t];void 0!==o&&o.component_toggled()}).on("click",".subsubsub a",function(t){var o=e(this),n=e(this).closest(".bto_group").data("component_metabox_id");y[n].section_changed(o),t.preventDefault()}).on("click","a.remove_row",function(t){var o=e(this).closest(".bto_group"),n=o.data("component_metabox_id");o.find("*").off(),o.remove(),delete y[n],h.triggerHandler("wc-cp-components-changed"),t.preventDefault()}).on("click","button.add_bto_group",function(){h.block(S),w++;var o={action:"woocommerce_add_composite_component",post_id:woocommerce_admin_meta_boxes.post_id,id:w,security:wc_composite_admin_params.add_component_nonce};return setTimeout(function(){e.post(woocommerce_admin_meta_boxes.ajax_url,o,function(o){b.append(o);var n=e(".bto_group",b).last(),i=new t(n),a="component_"+w;n.data("component_metabox_id",a),y[a]=i,h.triggerHandler("wc-cp-components-changed"),i.initialize_selects(),n.find(".woocommerce-help-tip").tipTip(D),h.triggerHandler("wc-cp-component-added",[i]),h.unblock()})},250),!1}).on("keyup","input.group_title",function(){var t=e(this).closest(".bto_group").data("component_metabox_id");y[t].title_changed()}).on("change","select.component_query_type",function(){var t=e(this).closest(".bto_group").data("component_metabox_id");y[t].query_type_changed()}).on("change","select.categories_selector",function(){var t=e(this).closest(".bto_group").data("component_metabox_id");y[t].categories_changed()}).on("change","select.products_selector",function(){var t=e(this).closest(".bto_group").data("component_metabox_id");y[t].products_changed()}).on("change","select.default_selector_categories",function(){var t=e(this).closest(".bto_group").data("component_metabox_id");y[t].default_option_changed()}).on("change","select.default_selector_products",function(){var t=e(this).closest(".bto_group").data("component_metabox_id");y[t].default_option_changed()}).on("change","input.component_optional",function(){var t=e(this).closest(".bto_group").data("component_metabox_id");y[t].optional_changed()}).on("change","select.options_style_selector",function(){var t=e(this).closest(".bto_group").data("component_metabox_id");y[t].options_style_changed()}).on("change",".group_priced_individually input",function(){var t=e(this).closest(".bto_group").data("component_metabox_id");y[t].priced_individually_input_changed()}).on("change",".group_show_filters input",function(){var t=e(this).closest(".bto_group").data("component_metabox_id");y[t].show_filters_input_changed()}).on("click",".upload_component_image_button",function(t){H.$button=e(this),t.preventDefault(),H.image_frame?H.image_frame.open():(H.image_frame=wp.media({title:wc_composite_admin_params.i18n_choose_component_image,button:{text:wc_composite_admin_params.i18n_set_component_image},states:[new wp.media.controller.Library({title:wc_composite_admin_params.i18n_choose_component_image,filterable:"all"})]}),H.image_frame.on("select",function(){var e=H.image_frame.state().get("selection").first().toJSON(),t=e.sizes&&e.sizes.thumbnail?e.sizes.thumbnail.url:e.url;H.$button.addClass("has_image"),H.$button.closest(".component_image").find(".remove_component_image_button").addClass("has_image"),H.$button.find("input").val(e.id).change(),H.$button.find("img").eq(0).attr("src",t)}),H.image_frame.open())}).on("click",".remove_component_image_button",function(t){var o=e(this),n=o.closest(".component_image"),i=n.find(".upload_component_image_button");t.preventDefault(),i.removeClass("has_image"),o.removeClass("has_image"),n.find("input").val("").change(),i.find("img").eq(0).attr("src",wc_composite_admin_params.wc_placeholder_img_src)})}function a(){b.sortable({items:".bto_group",cursor:"move",axis:"y",handle:".sort-item",scrollSensitivity:40,forcePlaceholderSize:!0,helper:"clone",opacity:.65,placeholder:"wc-metabox-sortable-placeholder",start:function(e,t){t.item.css("background-color","#f6f6f6")},stop:function(e,t){t.item.removeAttr("style"),h.triggerHandler("wc-cp-components-changed")}}),n()}function c(){y={},v.each(function(o){var n=e(this),i="component_"+o;n.data("component_metabox_id",i),y[i]=new t(n)}),a()}function s(e){var t=this;this.$el=e,this.$content=e.find(".bto_scenario_data"),this.$metabox_title=e.find("h3 .scenario_name"),this.$title_input=this.$content.find("input.scenario_title"),this.$conditional_components_action_input=this.$content.find(".toggle_conditional_components input"),this.$conditional_components_action_config=this.$content.find(".scenario_action_conditional_components_group .action_components"),this.initialized_selects=!1,this.scenario_toggled=function(){t.scenario_poked();var e=this.$el,o=this.$content;setTimeout(function(){e.toggleClass("closed").toggleClass("open"),o.stop().slideToggle()},50)},this.scenario_poked=function(){t.initialized_selects||t.initialize_selects()},this.title_changed=function(){t.$metabox_title.text(t.$title_input.val())},this.match_component_changed=function(e){e.is(":checked")?e.closest(".bto_scenario_selector").find(".bto_scenario_matching_conditions_wrapper").show():e.closest(".bto_scenario_selector").find(".bto_scenario_matching_conditions_wrapper").hide()},this.conditional_components_action_input_changed=function(){t.$conditional_components_action_input.is(":checked")?t.$conditional_components_action_config.show():t.$conditional_components_action_config.hide()},this.initialize_selects=function(){var e=t.$content.find(".wc-component-options-search-lazy"),o=t.$content.find(".wc-enhanced-select-lazy");e.addClass("wc-component-options-search"),o.addClass("wc-enhanced-select"),t.$content.wc_cp_select2(),t.$content.wc_cp_select2_component_options(),e.removeClass("wc-component-options-search"),o.removeClass("wc-enhanced-select"),t.initialized_selects=!0},this.initialize=function(){},this.initialize()}function _(){z.length>0?x.removeClass("disabled"):x.addClass("disabled")}function r(){C.on("click",".expand_all",function(){return!e(this).hasClass("disabled")&&(e.each(q,function(e,t){t.initialize_selects(),setTimeout(function(){t.$el.addClass("open").removeClass("closed"),t.$content.show()},50)}),!1)}).on("click",".close_all",function(){return!e(this).hasClass("disabled")&&(e.each(q,function(e,t){setTimeout(function(){t.$el.addClass("closed").removeClass("open"),t.$content.hide()},10)}),!1)}).on("mouseover",".bto_scenario_handle",function(){var t=e(this).closest(".bto_scenario").data("scenario_metabox_id"),o=q[t];void 0!==o&&o.scenario_poked()}).on("click",".bto_scenario_handle",function(){var t=e(this).closest(".bto_scenario").data("scenario_metabox_id"),o=q[t];void 0!==o&&o.scenario_toggled()}).on("click","a.remove_row",function(t){var o=e(this).closest(".bto_scenario"),n=o.data("scenario_metabox_id");o.find("*").off(),o.remove(),delete q[n],$.triggerHandler("wc-cp-scenarios-changed"),t.preventDefault()}).on("keyup","input.scenario_title",function(){var t=e(this).closest(".bto_scenario").data("scenario_metabox_id");q[t].title_changed()}).on("change","input.bto_scenario_match_component",function(){var t=e(this).closest(".bto_scenario").data("scenario_metabox_id");q[t].match_component_changed(e(this))}).on("change",".toggle_conditional_components input",function(){var t=e(this).closest(".bto_scenario").data("scenario_metabox_id");q[t].conditional_components_action_input_changed()}).on("click","button.add_bto_scenario",function(){$.block(S),T++;var t={action:"woocommerce_add_composite_scenario",post_id:woocommerce_admin_meta_boxes.post_id,id:T,security:wc_composite_admin_params.add_scenario_nonce};return setTimeout(function(){e.post(woocommerce_admin_meta_boxes.ajax_url,t,function(t){k.append(t);var o=e(".bto_scenario",k).last(),n=new s(o),i="scenario_"+T;o.data("scenario_metabox_id",i),q[i]=n,$.triggerHandler("wc-cp-scenarios-changed"),n.initialize_selects(),o.find(".tips, .woocommerce-help-tip").tipTip(D),$.triggerHandler("wc-cp-scenario-added",[n]),$.unblock()})},250),!1})}function l(){k.sortable({items:".bto_scenario",cursor:"move",axis:"y",handle:".sort-item",scrollSensitivity:40,forcePlaceholderSize:!0,helper:"clone",opacity:.65,placeholder:"wc-metabox-sortable-placeholder",start:function(e,t){t.item.css("background-color","#f6f6f6")},stop:function(e,t){t.item.removeAttr("style"),$.triggerHandler("wc-cp-scenarios-changed")}}),_()}function d(){q={},z.each(function(t){var o=e(this),n="scenario_"+t;o.data("scenario_metabox_id",n),q[n]=new s(o)}),l()}function p(){h.block(S),$.block(S),v.find("*").off();var t={post_id:woocommerce_admin_meta_boxes.post_id,data:e("#bto_product_data, #bto_scenario_data").find("input, select, textarea").serialize(),action:"woocommerce_bto_composite_save",security:wc_composite_admin_params.save_composite_nonce};setTimeout(function(){A=e.post(woocommerce_admin_meta_boxes.ajax_url,t,function(t){var n=window.location.toString();n=n.replace("post-new.php?","post.php?post="+woocommerce_admin_meta_boxes.post_id+"&action=edit&"),e.get(n,function(n){var i=[],a=[],s=e("#bto_config_group_inner",h),_=e("#bto_scenarios_inner",$),r=e(n).find("#bto_config_group_inner"),l=r.find(".bto_group"),p=e(n).find("#bto_scenarios_inner"),u=p.find(".bto_scenario");v.length===l.length&&v.each(function(){var t=e(this);if(t.hasClass("open")){var o=t.attr("rel");i.push(o)}}),l.each(function(){var t=e(this),o=t.attr("rel");-1!==e.inArray(o,i)?(t.addClass("open").removeClass("closed"),t.find(".wc-metabox-content").show()):t.find(".wc-metabox-content").hide()}),z.length===u.length&&_.find(".bto_scenario").each(function(){var t=e(this);if(t.hasClass("open")){var o=t.attr("rel");a.push(o)}}),u.each(function(){var t=e(this),o=t.attr("rel");-1!==e.inArray(o,a)?(t.addClass("open").removeClass("closed"),t.find(".wc-metabox-content").show()):t.find(".wc-metabox-content").hide()}),v.find("*").off(),z.find("*").off(),s.html(r.html()),_.html(p.html()),m=s.find(".bulk_toggle_wrapper"),x=_.find(".bulk_toggle_wrapper"),h.triggerHandler("wc-cp-components-changed"),c(),$.triggerHandler("wc-cp-scenarios-changed"),d(),e("#bto_product_data .woocommerce-help-tip, #bto_scenario_data .woocommerce-help-tip, #bto_scenario_data .tips").tipTip(D),v.each(function(){var t=e(this);if(t.hasClass("open")){var o=t.data("component_metabox_id");y[o].initialize_selects()}}),z.each(function(){var t=e(this);if(t.hasClass("open")){var o=t.data("scenario_metabox_id");q[o].initialize_selects()}}),t.length>0&&e.each(t,function(e,t){window.alert(t)}),h.unblock(),$.unblock(),A=!1,o(!1)})},"json")},250)}var u={language:{errorLoading:function(){return wc_composite_admin_params.i18n_searching},inputTooLong:function(e){var t=e.input.length-e.maximum;return 1===t?wc_composite_admin_params.i18n_input_too_long_1:wc_composite_admin_params.i18n_input_too_long_n.replace("%qty%",t)},inputTooShort:function(e){var t=e.minimum-e.input.length;return 1===t?wc_composite_admin_params.i18n_input_too_short_1:wc_composite_admin_params.i18n_input_too_short_n.replace("%qty%",t)},loadingMore:function(){return wc_composite_admin_params.i18n_load_more},maximumSelected:function(e){return 1===e.maximum?wc_composite_admin_params.i18n_selection_too_long_1:wc_composite_admin_params.i18n_selection_too_long_n.replace("%qty%",e.maximum)},noResults:function(){return wc_composite_admin_params.i18n_no_matches},searching:function(){return wc_composite_admin_params.i18n_searching}}};e.fn.wc_cp_select2=function(){e(":input.wc-enhanced-select",this).filter(":not(.enhanced)").each(function(){var t=e(this),o=e.extend({minimumResultsForSearch:10,allowClear:!!t.data("allow_clear"),placeholder:t.data("placeholder"),closeOnSelect:!0,dropdownParent:t.closest("#bto_product_data, #bto_scenario_data")},u);if("yes"===wc_composite_admin_params.is_wc_version_gte_3_2?t.selectWoo(o).addClass("enhanced"):t.select2(o).addClass("enhanced"),t.on("select2:unselecting",function(){t.data("unselecting",!0)}).on("select2:opening",function(e){t.data("unselecting")&&(t.removeData("unselecting"),e.preventDefault())}),t.data("sortable")){var n=t.next(".select2-container").find("ul.select2-selection__rendered");n.sortable({placeholder:"ui-state-highlight select2-selection__choice",forcePlaceholderSize:!0,items:"li:not(.select2-search__field)",tolerance:"pointer",stop:function(){e(n.find(".select2-selection__choice").get().reverse()).each(function(){var o=e(this).data("data").id,n=t.find('option[value="'+o+'"]')[0];t.prepend(n)})}})}}),e(":input.wc-product-search",this).filter(":not(.enhanced)").each(function(){var t=e(this),o={allowClear:!!t.data("allow_clear"),placeholder:t.data("placeholder"),minimumInputLength:t.data("minimum_input_length")?t.data("minimum_input_length"):"3",escapeMarkup:function(e){return e},ajax:{url:wc_enhanced_select_params.ajax_url,dataType:"json",delay:250,data:function(e){return{term:e.term,action:t.data("action")||"woocommerce_json_search_products_and_variations",security:wc_enhanced_select_params.search_products_nonce,exclude:t.data("exclude"),include:t.data("include"),limit:t.data("limit")}},processResults:function(t){var o=[];return t&&e.each(t,function(e,t){o.push({id:e,text:t})}),{results:o}},cache:!0}};if(o=e.extend(o,u),"yes"===wc_composite_admin_params.is_wc_version_gte_3_2?t.selectWoo(o).addClass("enhanced"):t.select2(o).addClass("enhanced"),t.on("select2:unselecting",function(){t.data("unselecting",!0)}).on("select2:opening",function(e){t.data("unselecting")&&(t.removeData("unselecting"),e.preventDefault())}),t.data("sortable")){var n=e(this).next(".select2-container").find("ul.select2-selection__rendered");n.sortable({placeholder:"ui-state-highlight select2-selection__choice",forcePlaceholderSize:!0,items:"li:not(.select2-search__field)",tolerance:"pointer",stop:function(){if(e(n.find(".select2-selection__choice").get().reverse()).each(function(){var o=e(this).data("data").id,n=t.find('option[value="'+o+'"]')[0];t.prepend(n)}),t.hasClass("products_selector")){var o=t.closest(".bto_group").data("component_metabox_id");y[o].products_changed()}}})}else t.prop("multiple")&&t.on("change",function(){var e=t.children();e.sort(function(e,t){var o=e.text.toLowerCase(),n=t.text.toLowerCase();return o>n?1:o<n?-1:0}),t.html(e)})})},e.fn.wc_cp_select2_component_options=function(){e(":input.wc-component-options-search",this).filter(":not(.enhanced)").each(function(){var t=e(this),o=t.data("action"),n={allowClear:!!t.data("allow_clear"),placeholder:t.data("placeholder"),minimumInputLength:t.data("minimum_input_length")?e(this).data("minimum_input_length"):"3",escapeMarkup:function(e){return e},ajax:{url:wc_enhanced_select_params.ajax_url,dataType:"json",quietMillis:250,data:function(e){return{term:e.term,action:o,security:wc_enhanced_select_params.search_products_nonce,exclude:t.data("exclude"),include:t.data("include"),limit:t.data("limit")}},processResults:function(o){var n=[];return"yes"===t.data("component_optional")&&n.push({id:"-1",text:wc_composite_admin_params.i18n_none}),n.push({id:"0",text:wc_composite_admin_params.i18n_all}),o&&e.each(o,function(e,t){n.push({id:e,text:t})}),{results:n}},cache:!0}};n=e.extend(n,u),"yes"===wc_composite_admin_params.is_wc_version_gte_3_2?e(this).selectWoo(n).addClass("enhanced"):e(this).select2(n).addClass("enhanced"),t.on("select2:unselecting",function(){t.data("unselecting",!0)}).on("select2:opening",function(e){t.data("unselecting")&&(t.removeData("unselecting"),e.preventDefault())})})};var h=e("#bto_product_data"),f=h.find("#_bto_shop_price_calc"),m=h.find(".bulk_toggle_wrapper"),g=e(".config_group",h),b=e(".bto_groups",g),v=e(".bto_group",b),w=v.length,y={},$=e("#bto_scenario_data"),x=$.find(".bulk_toggle_wrapper"),C=e(".scenarios_config_group",$),k=e(".bto_scenarios",$),z=e(".bto_scenario",k),T=z.length,q={},j=!1,H={image_frame:!1,$button:!1},S={message:null,overlayCSS:{background:"#fff",opacity:.6}},D={attribute:"data-tip",fadeIn:50,fadeOut:50,delay:200};e(".composite_stock_msg").appendTo("._manage_stock_field .description"),e("#_sold_individually").closest(".form-field").addClass("hide_if_composite"),e("#linked_product_data .grouping.show_if_simple, #linked_product_data .form-field.show_if_grouped").addClass("hide_if_composite"),e(".show_if_simple:not(.hide_if_composite)").addClass("show_if_composite"),"undefined"==typeof woocommerce_admin_meta_boxes&&(woocommerce_admin_meta_boxes=woocommerce_writepanel_params),e("body").on("woocommerce-product-type-change",function(t,o){"composite"===o&&(e(".show_if_external").hide(),e(".show_if_composite").show(),e("input#_manage_stock").change())}),e("select#product-type").change(),e("input#_downloadable").change(function(){e("select#product-type").change()}),f.data("val",f.val()),h.off("click").on("click",".bto_layout_label",function(){e(this).closest(".bto_layouts").find(".selected").removeClass("selected"),e(this).addClass("selected")}).on("change","#_bto_shop_price_calc",function(){var t=e(this).val(),o=!1;"defaults"===t&&e.each(y,function(e,t){if(!t.is_optional()&&!t.get_default_option())return o=!0,window.alert(wc_composite_admin_params.i18n_defaults_unset),f.val(f.data("val")),!1}),o||f.data("val",t)}).one("wc-cp-component-added",function(){g.removeClass("options_group--boarding")}).on("wc-cp-components-changed",function(){b=e(".bto_groups",g),(v=e(".bto_group",b)).each(function(t,o){e(".group_position",o).val(t),e(o).attr("rel",t)}),o(!0),n()}),$.off("click").one("wc-cp-scenario-added",function(){C.removeClass("options_group--boarding")}).on("wc-cp-scenarios-changed",function(){k=e(".bto_scenarios",$),(z=e(".bto_scenario",k)).each(function(t,o){e(".scenario_position",o).val(t),e(o).attr("rel",t)}),_()}),i(),c(),r(),d();var I=e(".cp_scenarios_tab"),L=I.find("a"),A=!1;I.prepend('<a class="cp_scenarios_tab_inner" href="#bto_scenario_data"></a>');var P=I.find("a.cp_scenarios_tab_inner");P.html(L.html()),P.on("click",function(){return j&&!A?window.confirm(wc_composite_admin_params.i18n_scenarios_panel_blocked)&&(L.trigger("click"),setTimeout(function(){p()},150)):L.trigger("click"),!1}),"yes"===wc_composite_admin_params.is_first_composite&&(e("select#product-type").val("composite").change().focus(),setTimeout(function(){e(".composite_product_options a").trigger("click")},500))});